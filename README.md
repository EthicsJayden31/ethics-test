# 윤리 성향 진단 검사

이 프로젝트는 웹 브라우저에서 동작하는 **윤리 성향 진단 단일 페이지 애플리케이션(SPA)** 입니다. 사용자는 32개 문항에 7점 척도로 응답하고, 시스템은 4개 축(A/B/C/D)의 성향을 계산해 16가지 유형 코드(예: `RIHA`)로 결과를 보여줍니다.

---

## 1) 프로젝트 개요

- **목적**: 윤리적 판단 경향을 간단한 자기진단 형태로 확인
- **구성**: `index.html` 단일 파일(HTML/CSS/JavaScript 포함)
- **특징**
  - 1문항씩 표시되는 설문 화면
  - 페이지 로드 시 설문 문항 1회 무작위 섞기
  - 결과 유형 코드 + 설명 + 관심 주제 + 관련 사상가 제공
  - 요소별 세부 성향 시각화(축별 바/마커)
  - 결과 제출 시 학번(숫자 5자리) 검증 후 전송
  - Apps Script에서 `student_id`/`Students_id` 컬럼 동시 기록 지원

---

## 2) 파일 구조

현재 저장소는 아래와 같이 매우 단순한 구조입니다.

- `index.html`: 애플리케이션 전체 소스
- `README.md`: 본 문서
- `apps-script/Code.gs`: Google Sheets 결과 수집용 Apps Script 코드

> 정리: 현재 저장소는 운영에 필요한 파일(`index.html`, `README.md`, `apps-script/Code.gs`)만 유지하도록 정리했습니다.

---

## 3) 실행 방법

### A. 가장 간단한 실행(로컬 파일 직접 열기)

1. 저장소를 준비합니다.
2. `index.html` 파일을 브라우저에서 직접 엽니다.

> 주의: 일부 브라우저/환경에서 `file://` 실행 시 제약이 있을 수 있으므로, 아래의 로컬 서버 실행을 권장합니다.

### B. 로컬 서버로 실행(권장)

프로젝트 루트에서 아래 명령을 실행합니다.

```bash
python3 -m http.server 4173
```

그 다음 브라우저에서 접속합니다.

```text
http://localhost:4173/index.html
```

---

## 4) 사용 흐름(사용자 관점)

1. 메인 페이지에서 **검사 시작** 클릭
2. 각 문항에 대해 1~7점 척도로 응답
3. 마지막 문항까지 완료 후 **결과 확인** 클릭
4. 결과 페이지에서 유형/세부 성향 확인
5. **결과 제출** 클릭 시 학번 입력 팝업 노출
   - 안내 문구: `학번을 입력하세요.(예시: 20300)`
   - 숫자 5자리 입력 시에만 제출 가능
   - 성공 시 `제출이 완료되었습니다.` 알림 출력
   - 같은 결과 화면에서는 중복 제출 차단

---

## 5) 코드 동작 설명

## 5-1. 설문 데이터와 무작위 섞기

- `questions` 배열에 문항이 정의되어 있습니다.
- 페이지 로드 시 `shuffleInPlace()`(Fisher–Yates)로 배열을 **한 번만** 섞습니다.
- 이로 인해 사용자마다 문항 순서가 달라질 수 있습니다.

## 5-2. 응답 저장과 이동

- `answers` 배열에 문항별 응답값을 저장합니다.
- `renderQuestion()`이 현재 문항을 그리고, `updateButtons()`가 이전/다음/결과 버튼 상태를 관리합니다.
- 모든 문항 응답이 완료되어야 결과 계산이 가능합니다.

## 5-3. 결과 계산 로직

- 축 구성
  - A: `R` vs `P`
  - B: `I` vs `C`
  - C: `H` vs `E`
  - D: `A` vs `S`
- 각 축에서 양쪽 극의 평균을 비교해 우세 극을 결정합니다.
- 평균이 매우 비슷하면(근접 구간) 보조 규칙(강한 응답 수, 확신도)로 tie-break를 수행합니다.
- 최종적으로 4글자 코드(예: `PCES`)를 만들고 `typeDB`에서 설명/주제/사상가를 조회합니다.

## 5-4. 세부 성향 시각화

- 축별 `diff`를 바탕으로 마커 위치를 계산합니다.
- `diff > 0`이면 왼쪽 성향(p1), `diff < 0`이면 오른쪽 성향(p2)에 더 가깝게 표시합니다.
- 태그(`중간`, `조금 더 가까움`, `꽤 가까움`, `많이 가까움`)로 거리감을 정성적으로 표시합니다.

## 5-5. 결과 제출

- `submitResult()`에서 다음 절차를 수행합니다.
  1. 결과가 생성되었는지 확인
  2. 이미 제출되었는지 확인(중복 제출 차단)
  3. `prompt`로 학번 입력
  4. 숫자 5자리 형식 검증
  5. `student_id`를 포함한 payload 전송
- 전송 방식은 `sendBeacon` 우선, 실패/미지원 시 `fetch(no-cors)` 폴백을 사용합니다.

---

## 6) 버전 표기

- 하단 고정 버전 표시(`APP_VERSION`)는 화면 우측 하단에 짧게 표시됩니다.
- 배포/수정 시 `APP_VERSION` 값을 갱신해 이력 관리를 권장합니다.

---

## 7) 커스터마이징 가이드

### 문항 수정

- `questions` 배열 항목을 추가/수정/삭제합니다.
- 각 항목은 `{ t, axis, pole }` 형태를 유지해야 합니다.

### 유형 설명 수정

- `typeDB`의 각 코드(`RIHA` 등)에 대해
  - `name`
  - `desc`
  - `issues`
  - `thinkers`
  를 조정하면 결과 텍스트가 변경됩니다.

### 스타일 수정

- `index.html` 상단 `<style>` 블록에서
  - 컬러 변수(`:root`)
  - 카드/버튼/반응형 레이아웃
  - 결과 섹션 스타일
  을 직접 조정할 수 있습니다.

### 제출 엔드포인트 변경

- `GAS_WEBAPP_URL` 값을 원하는 웹앱 URL로 변경하면 됩니다.

---

## 8) 운영 시 주의사항

- 본 검사는 교육/자가진단 성격의 도구이며, 임상/의학적 진단 도구가 아닙니다.
- 학번 등 식별정보를 수집할 경우, 기관 정책 및 개인정보 보호 규정을 반드시 준수하세요.
- 전송 로그 및 저장 정책(보관 기간, 접근 권한)을 사전에 명확히 정의하는 것을 권장합니다.

---

## 9) 향후 개선 아이디어

- 제출 시 `prompt` 대신 커스텀 모달 UI 적용(접근성/사용성 개선)
- 문항 랜덤 시드 고정 옵션(반/학급 단위 동일 순서 실험)
- 결과 내보내기(CSV/PDF) 기능
- 관리자용 집계 대시보드 연동



---

## 10) Google Sheets + Apps Script 연동 방법

이 프로젝트는 프런트엔드(`index.html`)에서 `GAS_WEBAPP_URL`로 결과를 전송합니다.
학번(`student_id`)까지 저장하려면 아래 절차대로 Apps Script를 배포하세요.

### 10-1. Apps Script 준비

1. Google Sheets를 새로 만들거나 기존 수업용 시트를 엽니다.
2. 상단 메뉴 **확장 프로그램 → Apps Script**를 클릭합니다.
3. 이 저장소의 `apps-script/Code.gs` 내용을 복사해서 붙여넣고 저장합니다.

### 10-2. 웹 앱 배포

1. Apps Script 우측 상단 **배포 → 새 배포**를 선택합니다.
2. 유형을 **웹 앱**으로 선택합니다.
3. 실행 사용자: **나**
4. 액세스 권한: **링크가 있는 모든 사용자**(또는 학교 정책에 맞는 범위)
5. 배포 후 생성된 URL을 복사합니다.

### 10-3. 프런트엔드 연결

`index.html`의 아래 상수값을 배포 URL로 교체합니다.

```js
const GAS_WEBAPP_URL = "https://script.google.com/macros/s/.../exec";
```

### 10-4. 저장 컬럼(기본)

`apps-script/Code.gs`는 `responses` 시트를 자동 생성하고 다음 컬럼을 기록합니다.

- `timestamp`
- `student_id`, `Students_id` (둘 다 동일 값으로 기록, 숫자 5자리 검증)
- `version`, `code`
- `A_side`, `A_strength`
- `B_side`, `B_strength`
- `C_side`, `C_strength`
- `D_side`, `D_strength`
- `neutral_rate`, `max_same_rate`
- `raw_json`

### 10-5. 학번이 기록되지 않을 때 점검 항목

1. `index.html`에서 제출 payload에 `student_id`가 포함되어 있는지 확인
2. Apps Script가 최신 코드로 재배포되었는지 확인(수정 후 **새 버전 배포** 필요)
3. 웹 앱 URL이 `index.html`의 `GAS_WEBAPP_URL`과 일치하는지 확인
4. 시트에 `Students_id` 컬럼만 있는 기존 양식이라도 최신 코드가 자동으로 `student_id`/`Students_id`를 보강하는지 확인
5. 시트 탭 이름이 `responses`인지 확인(코드에서 자동 생성됨)
6. 제출 후 Apps Script 실행 로그(Executions)에서 에러 메시지 확인

> 현재 시트 헤더가 `server_timestamp`, `app_version`, `type_code` 형태의 기존 양식이어도 최신 `Code.gs`는 해당 헤더를 유지하면서 `student_id`/`Students_id` 컬럼을 자동 보강해 함께 기록합니다.

---

## 11) GitHub Pages를 통한 수업 중 활용 방법

### 11-1. 배포

1. GitHub 저장소의 **Settings → Pages**로 이동
2. Source를 `Deploy from a branch`로 설정
3. 브랜치(예: `main`)와 루트(`/`)를 선택하고 저장
4. 생성된 공개 URL(예: `https://<org>.github.io/<repo>/`)을 확인

### 11-2. 수업 운영 권장 시나리오

1. 교사는 수업 시작 전
   - GitHub Pages URL 정상 접속 확인
   - Apps Script/Sheets 수집 테스트 1회 수행
2. 학생은 스마트폰/PC에서 URL 접속 후 검사 진행
3. 결과 제출 시 학번 5자리를 입력해 제출
4. 교사는 Google Sheets에서 실시간으로 응답 수집 상태 확인

### 11-3. 안정적인 수업 운영 팁

- 수업 전날에 사전 리허설(학교 와이파이/모바일망 모두 테스트)
- URL은 단축 링크 또는 QR 코드로 제공
- 동시 접속이 많으면 제출 직후 1~2초 대기 안내
- 비상용으로 오프라인 수기 기록(학번, 유형 코드) 양식 준비

### 11-4. 개인정보/보안 주의

- 학번은 개인정보로 간주되므로 학교 지침에 따라 수집·보관·파기 정책을 명확히 하세요.
- 공개 저장소에 실제 수집 데이터나 민감한 운영 URL을 직접 커밋하지 마세요.
- 필요 시 Apps Script에서 허용 도메인/토큰 검증을 추가해 무단 제출을 줄일 수 있습니다.
